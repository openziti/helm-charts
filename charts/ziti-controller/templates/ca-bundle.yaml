{{- /* Only render the Bundle if configMapName is empty (we're creating our own, not using an external one) */ -}}
{{- if not .Values.ctrlPlaneCasBundle.configMapName }}
---
# Trust bundle containing all CA certificates needed for the Ziti network.
# With the unified PKI, all certificates chain to the edge-root CA via the edge-signer intermediate.
# This Bundle is only rendered once per cluster (during init), not for joining nodes.
apiVersion: trust.cert-manager.io/v1alpha1
kind: Bundle
metadata:
  name: {{ include "ziti-controller.fullname" . }}-ctrl-plane-cas
spec:
  sources:
    # Edge signer intermediate CA - issues all certificates in the unified PKI
    - secret:
        name: {{ include "ziti-controller.fullname" . }}-edge-signer-secret
        key: ca.crt
  target:
    configMap:
      key: {{ include "ziti-controller.ctrlPlaneCasFile" . }}
    {{- with .Values.ctrlPlaneCasBundle.namespaceSelector }}
    namespaceSelector:
        {{- toYaml . | nindent 8 }}
    {{- end }}
{{- end }}
